"use strict";var e=(e,t,n)=>new Promise(((o,a)=>{var r=e=>{try{l(n.next(e))}catch(t){a(t)}},i=e=>{try{l(n.throw(e))}catch(t){a(t)}},l=e=>e.done?o(e.value):Promise.resolve(e.value).then(r,i);l((n=n.apply(e,t)).next())}));Object.defineProperties(exports,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}});var t=require("../customElements.js"),n=require("../useUpdateUser.js"),o=require("../useProfileElementSetup.js");const a=t.defineComponent({name:"Editable Control",props:{title:{type:String,required:!0},editable:{type:Boolean,default:!0},onSave:{type:Function,required:!1},onCancel:{type:Function,required:!1},isEditing:{type:Boolean,default:void 0},errorMessage:{type:String,required:!1}},emits:["update:isEditing","editStart"],setup(e,n){const{t:o}=t.useLocale(),a=t.ref(!1),r=t.computed({get:()=>void 0===e.isEditing?a.value:e.isEditing,set(t){void 0!==e.isEditing?(n.emit("update:isEditing",t),t&&n.emit("editStart")):a.value=t}});const i=t.ref(),l=t.ref(!1);const s=new ResizeObserver((()=>{!function(){if(void 0===i.value)return;const e=i.value.getBoundingClientRect().width;l.value=e<415}()}));return t.onMounted((()=>{i.value&&s.observe(i.value)})),t.onBeforeUnmount((()=>{s.disconnect()})),{isEditingValue:r,save:function(){void 0!==e.onSave?e.onSave().then((e=>{e&&(r.value=!1)})):r.value=!1},cancel:function(){void 0!==e.onCancel?e.onCancel().then((()=>{r.value=!1})):r.value=!1},container:i,isCompact:l,t:o}}}),r={class:"user-info-label"},i={class:"login-info-control"},l={key:0,class:"edit-save-container"},s={class:"message is-danger"},d={key:0};var u=t._export_sfc(a,[["render",function(e,n,o,a,u,c){return t.openBlock(),t.createElementBlock("form",{onSubmit:n[3]||(n[3]=t.withModifiers(((...t)=>e.save&&e.save(...t)),["prevent"])),onKeyup:n[4]||(n[4]=t.withKeys(((...t)=>e.cancel&&e.cancel(...t)),["esc"]))},[t.createBaseVNode("div",{class:t.normalizeClass(["login-info-row",{isCompact:e.isCompact}]),ref:"container"},[t.createBaseVNode("div",r,t.toDisplayString(e.title),1),t.createBaseVNode("div",i,[t.renderSlot(e.$slots,"default")]),e.editable?(t.openBlock(),t.createElementBlock("div",l,[e.isEditing?t.createCommentVNode("",!0):(t.openBlock(),t.createElementBlock("div",{key:0,class:"edit-save-text",onClick:n[0]||(n[0]=t.withModifiers((t=>e.isEditingValue=!0),["prevent"]))},t.toDisplayString(e.t("edit")),1)),e.isEditing?(t.openBlock(),t.createElementBlock("div",{key:1,class:"edit-save-text",onClick:n[1]||(n[1]=t.withModifiers(((...t)=>e.save&&e.save(...t)),["prevent"]))},t.toDisplayString(e.t("save")),1)):t.createCommentVNode("",!0),e.isEditing?(t.openBlock(),t.createElementBlock("div",{key:2,class:"edit-save-text",onClick:n[2]||(n[2]=t.withModifiers(((...t)=>e.cancel&&e.cancel(...t)),["prevent"]))},t.toDisplayString(e.t("cancel")),1)):t.createCommentVNode("",!0)])):t.createCommentVNode("",!0),t.createBaseVNode("div",s,[e.errorMessage?(t.openBlock(),t.createElementBlock("div",d,t.toDisplayString(e.errorMessage),1)):t.createCommentVNode("",!0)])],2)],32)}]]);const c=t.defineComponent({name:"Phone Number",components:{EditableControl:u},props:{userInfo:{type:Object,required:!1},appId:{type:String,required:!0},required:{type:Boolean,required:!0},editable:{type:Boolean,required:!0}},emits:["globalMessage"],setup(o,a){var r;const{t:i}=t.useLocale(),l=t.ref(!1),{changePhoneRequest:s,updateInfoMessage:d,updatePhoneError:u,updatePending:c,identifierExists:p}=n.useUpdateUser(o.appId),f=t.computed((()=>{const e=i("phone-number");return e.charAt(0).toUpperCase()+e.slice(1)}));let v;(v||(v={})).NONE="N/A";const m=t.ref((null==(r=o.userInfo)?void 0:r.phone)||"N/A");let g=m.value,y="";const k=t.ref(),h=t.ref(),{defaultCountryCode:E}=t.useDefaultCountryCode();let I;function B(){m.value.trim()||(m.value="N/A")}return t.watch(k,(()=>{var e;I=n.intlTelInput(k.value,{initialCountry:null!=(e=null==I?void 0:I.getSelectedCountryData().iso2)?e:E.value,utilsScript:"https://cdnjs.cloudflare.com/ajax/libs/intl-tel-input/17.0.8/js/utils.js",dropdownContainer:h.value,autoPlaceholder:"aggressive"})})),{isEditing:l,phone:m,controlContainer:h,phoneInputBox:k,cancel:function(){return e(this,null,(function*(){u.value="",m.value=g,I&&(I.setCountry(y),m.value=m.value.replace(`+${null==I?void 0:I.getSelectedCountryData().dialCode}`,""))}))},save:function(){return e(this,null,(function*(){var t,n,r,l;const f=null!=(n=null==(t=o.userInfo)?void 0:t.phone)?n:"",v="N/A"===m.value?"":m.value;return u.value="",!o.required||null!=(r=null==I?void 0:I.getNumber())&&r?f===(null!=(l=null==I?void 0:I.getNumber())?l:"")?(B(),!0):(yield function(t,n){return e(this,null,(function*(){if(I){const e=null==I?void 0:I.getNumber();if(e&&!(null==I?void 0:I.isValidNumber()))return u.value=i("invalid-phone"),!1;if(n===e)return!1;if(e){const t=yield p(e).catch((()=>{u.value=i("something-went-wrong"),c.value=!1}));if(u.value)return!1;if(!t)return u.value=i("phone-number-already-in-use"),!1}if(n!==e)return yield s(e),""===u.value&&(a.emit("globalMessage",d.value),g=t,!0)}return!1}))}(v,f),!u.value&&(B(),!0)):(u.value=i("phone-number-is-required"),!1)}))},onEdit:function(){I&&(y=I.getSelectedCountryData().iso2),"N/A"===m.value?m.value="":m.value=m.value.replace(`+${null==I?void 0:I.getSelectedCountryData().dialCode}`,"")},updatePhoneError:u,updatePending:c,title:f,t:i}}}),p=["readonly"],f={ref:"controlContainer",style:{width:"100%"}};var v=t._export_sfc(c,[["render",function(e,n,o,a,r,i){const l=t.resolveComponent("loading"),s=t.resolveComponent("editable-control");return t.openBlock(),t.createElementBlock(t.Fragment,null,[e.updatePending?(t.openBlock(),t.createBlock(l,{key:0,active:e.updatePending},null,8,["active"])):t.createCommentVNode("",!0),t.createVNode(s,{title:e.title,isEditing:e.isEditing,"onUpdate:isEditing":n[2]||(n[2]=t=>e.isEditing=t),errorMessage:e.updatePhoneError,onEditStart:e.onEdit,onCancel:e.cancel,onSave:e.save,editable:!!e.userInfo&&e.editable},{default:t.withCtx((()=>[t.withDirectives(t.createBaseVNode("input",{type:"text",id:"phone",class:t.normalizeClass(["input short",{"is-danger":e.updatePhoneError}]),part:"input","onUpdate:modelValue":n[0]||(n[0]=t=>e.phone=t),readonly:!e.isEditing,onInput:n[1]||(n[1]=t=>e.updatePhoneError=""),ref:"phoneInputBox",inputmode:"tel",autocomplete:"tel"},null,42,p),[[t.vModelText,e.phone]]),t.createBaseVNode("div",f,null,512)])),_:1},8,["title","isEditing","errorMessage","onEditStart","onCancel","onSave","editable"])],64)}]]);const m=t.defineComponent({name:"Phone Number",components:{EditableControl:u},props:{userInfo:{type:Object,required:!1},appId:{type:String,required:!0},required:{type:Boolean,required:!0},editable:{type:Boolean,required:!0}},emits:["globalMessage"],setup(o,a){var r;const{t:i}=t.useLocale(),l=t.ref(!1),{changeEmailRequest:s,updateInfoMessage:d,updateEmailError:u,updatePending:c,identifierExists:p}=n.useUpdateUser(o.appId),f=t.computed((()=>{const e=i("email");return e.charAt(0).toUpperCase()+e.slice(1)}));let v;(v||(v={})).NONE="N/A";const m=t.ref((null==(r=o.userInfo)?void 0:r.email)||"N/A");let g=m.value;function y(){m.value.trim()||(m.value="N/A")}return{isEditing:l,email:m,cancel:function(){return e(this,null,(function*(){u.value="",m.value=g}))},save:function(){return e(this,null,(function*(){var t,r;const l=null!=(r=null==(t=o.userInfo)?void 0:t.email)?r:"",f="N/A"===m.value?"":m.value;return u.value="",o.required&&!f.trim()?(u.value=i("email-is-required"),!1):l===f.trim()?(y(),!0):(yield function(t,o){return e(this,null,(function*(){if(o!==t){const e=t.trim().toLowerCase();if(e&&!n.isEmail(m.value))return u.value=i("invalid-email"),!1;if(e){const t=yield p(e).catch((()=>{u.value=i("something-went-wrong"),c.value=!1}));if(u.value)return!1;if(!t)return u.value=i("email-address-already-in-use"),!1}if(yield s(e),""===u.value)return a.emit("globalMessage",d.value),g=t,!0}return!1}))}(f,l),!u.value&&(y(),!0))}))},onEdit:function(){"N/A"===m.value&&(m.value="")},updateEmailError:u,updatePending:c,title:f}}}),g=["readonly"];var y=t._export_sfc(m,[["render",function(e,n,o,a,r,i){const l=t.resolveComponent("loading"),s=t.resolveComponent("editable-control");return t.openBlock(),t.createElementBlock(t.Fragment,null,[e.updatePending?(t.openBlock(),t.createBlock(l,{key:0,active:e.updatePending},null,8,["active"])):t.createCommentVNode("",!0),t.createVNode(s,{title:e.title,isEditing:e.isEditing,"onUpdate:isEditing":n[2]||(n[2]=t=>e.isEditing=t),errorMessage:e.updateEmailError,onEditStart:e.onEdit,onCancel:e.cancel,onSave:e.save,editable:!!e.userInfo&&e.editable},{default:t.withCtx((()=>[t.withDirectives(t.createBaseVNode("input",{type:"text",class:t.normalizeClass(["input short",{"is-danger":e.updateEmailError}]),part:"input",readonly:!e.isEditing,"onUpdate:modelValue":n[0]||(n[0]=t=>e.email=t),onInput:n[1]||(n[1]=t=>e.updateEmailError=""),inputmode:"email",autocomplete:"email"},null,42,g),[[t.vModelText,e.email]])])),_:1},8,["title","isEditing","errorMessage","onEditStart","onCancel","onSave","editable"])],64)}]]);const k=t.defineComponent({name:"UserInfo",components:{PhoneNumber:v,Email:y},props:{userInfo:{type:Object,required:!1},appId:{type:String,required:!0},appInfo:{type:Object,required:!0}},setup(e){const{t:n}=t.useLocale(),o=t.ref("");const a=t.computed((()=>e.appInfo.allowed_identifier!==t.oe.phone)),r=t.computed((()=>e.appInfo.allowed_identifier!==t.oe.email)),i=t.computed((()=>e.appInfo.required_identifier===t.ae.Email||e.appInfo.required_identifier===t.ae.Both)),l=t.computed((()=>e.appInfo.required_identifier===t.ae.Phone||e.appInfo.required_identifier===t.ae.Both));return{message:o,globalMessage:function(e){o.value=e},showEmail:a,showPhone:r,emailRequired:i,phoneRequired:l,t:n}}}),h={class:"title secondary-title"},E={key:0};var I=t._export_sfc(k,[["render",function(e,n,o,a,r,i){const l=t.resolveComponent("email"),s=t.resolveComponent("phone-number");return t.openBlock(),t.createElementBlock(t.Fragment,null,[t.createBaseVNode("div",h,t.toDisplayString(e.t("login-info")),1),t.createBaseVNode("div",{class:t.normalizeClass(["feedback",e.message?"feedback-info":""])},[e.message?(t.openBlock(),t.createElementBlock("div",E,t.toDisplayString(e.message),1)):t.createCommentVNode("",!0)],2),e.showEmail?(t.openBlock(),t.createBlock(l,{key:0,appId:e.appId,userInfo:e.userInfo,required:e.emailRequired,editable:!!e.appInfo.profile_management,onGlobalMessage:e.globalMessage},null,8,["appId","userInfo","required","editable","onGlobalMessage"])):t.createCommentVNode("",!0),e.showPhone?(t.openBlock(),t.createBlock(s,{key:1,appId:e.appId,userInfo:e.userInfo,required:e.phoneRequired,editable:!!e.appInfo.profile_management,onGlobalMessage:e.globalMessage},null,8,["appId","userInfo","required","editable","onGlobalMessage"])):t.createCommentVNode("",!0)],64)}]]);const B=t.defineComponent({name:"Metadata Section",components:{UserMetadata:n.UserMetadata},props:{appInfo:{type:Object,required:!0},userInfo:{type:Object,required:!1},refreshMetadata:{type:Function,required:!0}},setup(o){const{t:a}=t.useLocale(),r=t.ref(!1),{updateMetadata:i,updateMetadataError:l}=n.useUpdateUser(o.appInfo.id);const s=t.ref();return{LayoutType:n.LayoutType,isEditing:r,save:function(){return e(this,null,(function*(){var e;let t=!0;if(s.value){if(!s.value.validate())return;(null==(e=o.userInfo)?void 0:e.user_metadata)&&(t=yield i(o.userInfo.user_metadata,o.appInfo.user_metadata_schema))}r.value=!t}))},cancel:function(){return e(this,null,(function*(){yield o.refreshMetadata(),s.value&&s.value.validate(),r.value=!1}))},componentRef:s,updateMetadataError:l,t:a}}}),C={class:"metadata-header"},b={class:"title secondary-title"},N={key:0,class:"edit-save-container"},M={key:0},w={key:1,style:{"text-align":"center"}},S={class:"title secondary-title"};var V=t._export_sfc(B,[["render",function(e,n,o,a,r,i){var l;const s=t.resolveComponent("user-metadata");return t.openBlock(),t.createElementBlock(t.Fragment,null,[t.createBaseVNode("div",C,[t.createBaseVNode("div",b,t.toDisplayString(e.t("personal-info")),1),e.userInfo&&e.appInfo.profile_management?(t.openBlock(),t.createElementBlock("div",N,[e.isEditing?t.createCommentVNode("",!0):(t.openBlock(),t.createElementBlock("div",{key:0,class:"edit-save-text",onClick:n[0]||(n[0]=t.withModifiers((t=>e.isEditing=!0),["prevent"]))},t.toDisplayString(e.t("edit")),1)),e.isEditing?(t.openBlock(),t.createElementBlock("div",{key:1,class:"edit-save-text",onClick:n[1]||(n[1]=t.withModifiers(((...t)=>e.save&&e.save(...t)),["prevent"]))},t.toDisplayString(e.t("save")),1)):t.createCommentVNode("",!0),e.isEditing?(t.openBlock(),t.createElementBlock("div",{key:2,class:"edit-save-text",onClick:n[2]||(n[2]=t.withModifiers(((...t)=>e.cancel&&e.cancel(...t)),["prevent"]))},t.toDisplayString(e.t("cancel")),1)):t.createCommentVNode("",!0)])):t.createCommentVNode("",!0)]),t.createBaseVNode("div",{class:t.normalizeClass(["feedback",e.updateMetadataError?"feedback-danger":""])},[e.updateMetadataError?(t.openBlock(),t.createElementBlock("div",M,t.toDisplayString(e.updateMetadataError),1)):t.createCommentVNode("",!0)],2),e.userInfo?(t.openBlock(),t.createBlock(s,{key:0,appInfo:e.appInfo,layoutType:e.LayoutType.Profile,userMetadata:null!=(l=e.userInfo.user_metadata)?l:{},ref:"componentRef",isEditing:e.isEditing},null,8,["appInfo","layoutType","userMetadata","isEditing"])):(t.openBlock(),t.createElementBlock("div",w,[t.createBaseVNode("div",S,t.toDisplayString(e.t("no-user-found")),1),t.createBaseVNode("div",null,t.toDisplayString(e.t("there-is-no-currently-logged-in-user")),1)]))],64)}]]);const q=t.defineComponent({name:"ProfileView",components:{UserInfo:I,DevicesTable:o._sfc_main,MetadataSection:V,Loading:o._sfc_main$1},props:{appId:{type:String,required:!0},appInfo:{type:Object,required:!0},webauthnAllowed:{type:Boolean,required:!0}},setup(e){const{userInfo:n,loading:a,error:r,refreshDevices:i,refreshMetadata:l}=o.useCurrentUser(e.appInfo);return{userInfo:n,loading:a,error:r,refreshDevices:i,refreshMetadata:l,PassageErrorCode:t.T}}}),_={key:1,class:"notification is-danger has-text-centered"},P={key:3,class:"profile-divider"},x=t.createBaseVNode("div",{class:"profile-divider"},null,-1);var D=t._export_sfc(q,[["render",function(e,n,o,a,r,i){const l=t.resolveComponent("loading"),s=t.resolveComponent("user-info"),d=t.resolveComponent("metadata-section"),u=t.resolveComponent("devices-table");return t.openBlock(),t.createElementBlock(t.Fragment,null,[e.loading?(t.openBlock(),t.createBlock(l,{key:0,active:e.loading},null,8,["active"])):e.error&&e.error.statusCode!==e.PassageErrorCode.PSGLoginRequired?(t.openBlock(),t.createElementBlock("div",_," Unable to get information about current user: "+t.toDisplayString(e.error.statusText),1)):t.createCommentVNode("",!0),e.loading?t.createCommentVNode("",!0):(t.openBlock(),t.createBlock(s,{key:2,appId:e.appId,userInfo:e.userInfo,appInfo:e.appInfo},null,8,["appId","userInfo","appInfo"])),e.appInfo.layouts.profile.length>0?(t.openBlock(),t.createElementBlock("div",P)):t.createCommentVNode("",!0),!e.loading&&e.appInfo.layouts.profile.length>0?(t.openBlock(),t.createBlock(d,{key:4,appInfo:e.appInfo,userInfo:e.userInfo,refreshMetadata:e.refreshMetadata},null,8,["appInfo","userInfo","refreshMetadata"])):t.createCommentVNode("",!0),x,e.loading?t.createCommentVNode("",!0):(t.openBlock(),t.createBlock(u,{key:5,appId:e.appId,userInfo:e.userInfo,refreshDevices:e.refreshDevices,webauthnAllowed:e.webauthnAllowed},null,8,["appId","userInfo","refreshDevices","webauthnAllowed"]))],64)}]]);const A={key:1,class:"notification is-danger has-text-centered"},U=t.defineComponent({__name:"MainView",props:{appId:{}},setup(n){const a=n,{appInfo:r,loading:i,invalidAppId:l}=t.useAppInfo(a.appId),s=t.ref(!1),d=t.ref(!1);return t.watch(r,(()=>e(this,null,(function*(){if(d.value=!1,void 0===r.value)return;const e=new t.Y(a.appId);e.checkWebauthnConfig(r.value)&&(s.value=(yield e.getCredentialAvailable()).platform),d.value=!0})))),(e,n)=>(t.openBlock(),t.createElementBlock(t.Fragment,null,[t.unref(i)||!d.value?(t.openBlock(),t.createBlock(o._sfc_main$1,{key:0,active:t.unref(i)||!d.value},null,8,["active"])):t.unref(l)?(t.openBlock(),t.createElementBlock("div",A," Passage-Profile Error: Invalid App ID. ")):t.createCommentVNode("",!0),t.unref(r)&&d.value?(t.openBlock(),t.createBlock(D,{key:2,appId:e.appId,appInfo:t.unref(r),webauthnAllowed:s.value},null,8,["appId","appInfo","webauthnAllowed"])):t.createCommentVNode("",!0)],64))}}),j=t.defineComponent({__name:"Profile.ce",props:{appId:{},lang:{},defaultCountryCode:{}},setup(e){const n=e,{languageLoading:a,containerRef:r}=o.useProfileElementSetup(n);return(e,n)=>{var o;return t.withDirectives((t.openBlock(),t.createElementBlock("div",{id:"passage-profile-container",ref_key:"containerRef",ref:r},[(t.openBlock(),t.createBlock(U,{key:e.appId,appId:null!=(o=e.appId)?o:""},null,8,["appId"]))],512)),[[t.vShow,!t.unref(a)]])}}});function R(){t.safelyRegisterElement(j,"profile")}R(),exports.registerPassageLoginElement=R;
//# 
