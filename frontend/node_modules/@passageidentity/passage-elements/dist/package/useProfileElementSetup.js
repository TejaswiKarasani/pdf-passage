"use strict";var e=Object.defineProperty,t=Object.defineProperties,a=Object.getOwnPropertyDescriptors,n=Object.getOwnPropertySymbols,o=Object.prototype.hasOwnProperty,l=Object.prototype.propertyIsEnumerable,r=(t,a,n)=>a in t?e(t,a,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[a]=n,i=(e,t)=>{for(var a in t||(t={}))o.call(t,a)&&r(e,a,t[a]);if(n)for(var a of n(t))l.call(t,a)&&r(e,a,t[a]);return e},c=(e,t,a)=>new Promise(((n,o)=>{var l=e=>{try{i(a.next(e))}catch(t){o(t)}},r=e=>{try{i(a.throw(e))}catch(t){o(t)}},i=e=>e.done?n(e.value):Promise.resolve(e.value).then(l,r);i((a=a.apply(e,t)).next())})),s=require("./customElements.js");const d=s.defineComponent({name:"Modal",props:{active:{type:Boolean,default:!1},title:{type:String,default:""},onPrimaryButton:{type:Function,required:!1},onCancelButton:{type:Function,required:!1},primaryButtonText:{type:String,default:"OK"},cancelButtonText:{type:String,default:"Cancel"},info:{type:Boolean,default:!1},cancelOnly:{type:Boolean,default:!1},danger:{type:Boolean,default:!1}},setup(e,t){const a=s.ref(!1);s.watchEffect((()=>{a.value=e.active,a.value?document.documentElement.classList.add("is-clipped"):document.documentElement.classList.remove("is-clipped")}));return s.onUnmounted((()=>document.documentElement.classList.remove("is-clipped"))),{isActive:a,closeModal:()=>{a.value=!1},primaryAction:function(){void 0!==e.onPrimaryButton?e.onPrimaryButton().then((e=>{e&&t.emit("update:active",!1)})):t.emit("update:active",!1)},cancelAction:function(){void 0!==e.onCancelButton?e.onCancelButton().then((()=>{t.emit("update:active",!1)})):t.emit("update:active",!1)}}}}),u=s.createBaseVNode("div",{class:"passage-modal-background"},null,-1),v={class:"passage-modal-card"},p={class:"passage-modal-body"},m={class:"passage-modal-footer"};var f=s._export_sfc(d,[["render",function(e,t,a,n,o,l){return s.openBlock(),s.createBlock(s.Transition,{name:"modal",mode:"out-in"},{default:s.withCtx((()=>[e.isActive?(s.openBlock(),s.createElementBlock("div",{key:0,class:s.normalizeClass(["passage-modal",{"is-active":e.isActive}]),part:"modal",role:"dialog",onKeyup:[t[2]||(t[2]=s.withKeys(((...t)=>e.primaryAction&&e.primaryAction(...t)),["enter"])),t[3]||(t[3]=s.withKeys(((...t)=>e.cancelAction&&e.cancelAction(...t)),["esc"]))]},[u,s.createBaseVNode("div",v,[s.createBaseVNode("div",{class:s.normalizeClass(["title main-title",{"danger-header":e.danger}])},s.toDisplayString(e.title),3),s.createBaseVNode("div",p,[s.renderSlot(e.$slots,"default")]),s.createBaseVNode("div",m,[e.cancelOnly?s.createCommentVNode("",!0):(s.openBlock(),s.createElementBlock("button",{key:0,class:"button is-modal",part:"modal-button modal-primary",onClick:t[0]||(t[0]=s.withModifiers(((...t)=>e.primaryAction&&e.primaryAction(...t)),["prevent"]))},s.toDisplayString(e.primaryButtonText),1)),e.info?s.createCommentVNode("",!0):(s.openBlock(),s.createElementBlock("button",{key:1,class:s.normalizeClass(["button is-secondary is-modal cancel-button",{"cancel-only":e.cancelOnly}]),part:"modal-button modal-secondary",onClick:t[1]||(t[1]=s.withModifiers(((...t)=>e.cancelAction&&e.cancelAction(...t)),["prevent"]))},s.toDisplayString(e.cancelButtonText),3))])])],34)):s.createCommentVNode("",!0)])),_:3})}]]);const g=s.defineComponent({name:"Revoke Device",components:{Modal:f},props:{device:{type:Object,required:!0},active:{type:Boolean,required:!0},currentDeviceId:{type:String,required:!1},appId:{type:String,required:!0}},emits:["dialogClose","update:active"],setup(e,t){const{t:a}=s.useLocale(),n=s.computed({get:()=>e.active,set(e){t.emit("update:active",e)}}),{revokeDevice:o,revokePending:l,errorMessage:r}=function(e){const{t:t}=s.useLocale(),a=new s.Y(e).getCurrentUser(),n=s.ref(!1),o=s.ref("");return{revokeDevice:function(e){return c(this,null,(function*(){n.value=!0;try{return yield a.deleteDevice(e),!0}catch(l){return o.value=t("failed-to-revoke-this-device"),!1}finally{n.value=!1}}))},revokePending:n,errorMessage:o}}(e.appId);return{showModal:n,onDeleteDevice:function(){return c(this,null,(function*(){if(r.value)return t.emit("dialogClose"),!0;const a=yield o(e.device);return a&&t.emit("dialogClose"),a}))},revokePending:l,errorMessage:r,t:a}}}),y={key:1},B={key:0},h={key:2,class:"text is-danger"};var k=s._export_sfc(g,[["render",function(e,t,a,n,o,l){const r=s.resolveComponent("loading"),i=s.resolveComponent("modal");return s.openBlock(),s.createBlock(i,{title:e.t("revoke-device"),active:e.showModal,"onUpdate:active":t[0]||(t[0]=t=>e.showModal=t),primaryButtonText:e.errorMessage?e.t("ok"):e.t("revoke-device"),onPrimaryButton:e.onDeleteDevice,info:!!e.errorMessage},{default:s.withCtx((()=>{var t;return[e.revokePending?(s.openBlock(),s.createBlock(r,{key:0,active:e.revokePending},null,8,["active"])):s.createCommentVNode("",!0),e.errorMessage?s.createCommentVNode("",!0):(s.openBlock(),s.createElementBlock("div",y,[s.createTextVNode(s.toDisplayString(e.t("confirm-remove-device"))+" ",1),(null==(t=e.device)?void 0:t.id)===e.currentDeviceId?(s.openBlock(),s.createElementBlock("b",B,s.toDisplayString(e.t("remove-current-device-warning")),1)):s.createCommentVNode("",!0),s.createTextVNode(" "+s.toDisplayString(e.t("are-you-sure-you-want-to-continue")),1)])),e.errorMessage?(s.openBlock(),s.createElementBlock("div",h,s.toDisplayString(e.errorMessage),1)):s.createCommentVNode("",!0)]})),_:1},8,["title","active","primaryButtonText","onPrimaryButton","info"])}]]);const C={class:"label input-box-title"},b={class:"message is-danger"},w={key:1,class:"text is-danger"},N=s.defineComponent({__name:"EditDevice",props:{deviceObject:{},active:{type:Boolean},newDevice:{type:Boolean},appId:{}},emits:["dialogClose","update:active"],setup(e,{emit:t}){const a=e,{t:n}=s.useLocale(),o=s.computed({get:()=>a.active,set(e){t("update:active",e)}});function l(){i.value="",p.value=""}function r(){return c(this,null,(function*(){t("dialogClose"),l()}))}const i=s.ref(""),d=s.ref("");s.onUpdated((()=>{var e,t;d.value=null!=(t=null==(e=a.deviceObject)?void 0:e.friendly_name)?t:""})),s.onMounted((()=>{var e,t;d.value=null!=(t=null==(e=a.deviceObject)?void 0:e.friendly_name)?t:""}));const{renameDevice:u,editPending:v,errorMessage:p}=function(e){const{t:t}=s.useLocale(),a=new s.Y(e).getCurrentUser(),n=s.ref(!1),o=s.ref("");return{renameDevice:function(e,l){return c(this,null,(function*(){n.value=!0;try{return yield a.editDevice(e,{friendly_name:l}),!0}catch(r){return o.value=t("failed-to-rename-this-device"),!1}finally{n.value=!1}}))},editPending:n,errorMessage:o}}(a.appId);function m(){return c(this,null,(function*(){if(!a.deviceObject)return!1;if(p.value)return t("dialogClose"),l(),!0;if(d.value===a.deviceObject.friendly_name)return t("dialogClose"),!0;if(!d.value)return i.value=n("device-name-is-required"),!1;if(d.value.length>64)return i.value=n("device-name-maximum"),!1;const e=yield u(a.deviceObject.id,d.value);return e?(t("dialogClose"),!0):e}))}const g=s.ref();return s.watch(g,(()=>{void 0!==g.value&&null!==g.value&&g.value.focus()})),(e,t)=>{const a=s.resolveComponent("loading");return s.openBlock(),s.createBlock(f,{title:e.newDevice?s.unref(n)("name-this-device"):s.unref(n)("edit-device"),active:o.value,"onUpdate:active":t[1]||(t[1]=e=>o.value=e),primaryButtonText:s.unref(p)?s.unref(n)("ok"):e.newDevice?s.unref(n)("add-device"):s.unref(n)("rename-device"),onPrimaryButton:m,onCancelButton:r,info:e.newDevice},{default:s.withCtx((()=>[s.unref(v)?(s.openBlock(),s.createBlock(a,{key:0,active:s.unref(v)},null,8,["active"])):s.createCommentVNode("",!0),s.createBaseVNode("div",null,s.toDisplayString(e.newDevice?s.unref(n)("give-this-device-a-name"):s.unref(n)("rename-this-device")),1),s.createBaseVNode("div",C,s.toDisplayString(e.newDevice?s.unref(n)("device-name"):s.unref(n)("new-device-name")),1),s.withDirectives(s.createBaseVNode("input",{type:"text",class:s.normalizeClass(["input",{"is-danger":i.value}]),"onUpdate:modelValue":t[0]||(t[0]=e=>d.value=e),onInput:l,part:"input",ref_key:"editDeviceInput",ref:g},null,34),[[s.vModelText,d.value]]),s.createBaseVNode("div",b,s.toDisplayString(i.value),1),s.unref(p)?(s.openBlock(),s.createElementBlock("div",w,s.toDisplayString(s.unref(p)),1)):s.createCommentVNode("",!0)])),_:1},8,["title","active","primaryButtonText","info"])}}}),D=s.defineComponent({__name:"PlatformIcon",setup(e){var t;const a=null!=(t=(new s.UAParser).getOS().name)?t:"";let n;return n=a.startsWith("Windows")?s.Icons.windowsHello:a.startsWith("Mac OS")||a.startsWith("iOS")?s.Icons.appleBiometric:s.Icons.genericBiometrics,(e,t)=>(s.openBlock(),s.createBlock(s.unref(s.InlineSvg),{src:s.unref(n),alt:"Platform device icon"},null,8,["src"]))}}),V=s.defineComponent({name:"Revoke Device",components:{Modal:f,EditDevice:N,InlineSvg:s.InlineSvg,PlatformIcon:D},props:{active:{type:Boolean,required:!0},appId:{type:String,required:!0}},emits:["dialogClose","update:active"],setup(e,t){const{t:a}=s.useLocale(),n=s.computed({get:()=>e.active,set(e){t.emit("update:active",e)}}),o=s.ref(!1),{addDevice:l,addPending:r,errorMessage:i}=s.useAddDevice(e.appId),d=s.ref();function u(){return c(this,null,(function*(){return d.value=yield l(),!!d.value&&(n.value=!1,o.value=!0,!0)}))}return s.watch(n,(()=>{n.value&&u()})),{showAddModal:n,showEditModal:o,addDevice:l,errorMessage:i,addPending:r,onAddDevice:u,newDevice:d,editDialogClose:function(){t.emit("dialogClose")},Icons:s.Icons,t:a}}}),x={class:"image has-text-centered",style:{margin:"5px auto"}},S={key:1,class:"has-text-centered"},M={key:2,class:"text is-danger has-text-centered"};var I=s._export_sfc(V,[["render",function(e,t,a,n,o,l){const r=s.resolveComponent("loading"),i=s.resolveComponent("inline-svg"),c=s.resolveComponent("platform-icon"),d=s.resolveComponent("modal"),u=s.resolveComponent("edit-device");return s.openBlock(),s.createElementBlock(s.Fragment,null,[s.createVNode(d,{title:e.t("add-passkey"),active:e.showAddModal,"onUpdate:active":t[0]||(t[0]=t=>e.showAddModal=t),cancelOnly:!e.errorMessage,onPrimaryButton:e.onAddDevice,primaryButtonText:e.t("try-again")},{default:s.withCtx((()=>[e.addPending?(s.openBlock(),s.createBlock(r,{key:0,active:e.addPending},null,8,["active"])):s.createCommentVNode("",!0),s.createBaseVNode("figure",x,[e.errorMessage?(s.openBlock(),s.createBlock(i,{key:0,src:e.Icons.fingerprintFailed,alt:"Biometrics scan failed"},null,8,["src"])):(s.openBlock(),s.createBlock(c,{key:1,alt:"Biometrics scan"}))]),e.errorMessage?s.createCommentVNode("",!0):(s.openBlock(),s.createElementBlock("div",S,s.toDisplayString(e.t("enable-this-device")),1)),e.errorMessage?(s.openBlock(),s.createElementBlock("div",M,s.toDisplayString(e.errorMessage),1)):s.createCommentVNode("",!0)])),_:1},8,["title","active","cancelOnly","onPrimaryButton","primaryButtonText"]),s.createVNode(u,{active:e.showEditModal,"onUpdate:active":t[1]||(t[1]=t=>e.showEditModal=t),"app-id":e.appId,deviceObject:e.newDevice,onDialogClose:e.editDialogClose,newDevice:""},null,8,["active","app-id","deviceObject","onDialogClose"])],64)}]]);const _=s.defineComponent({name:"Loading",props:{active:Boolean},setup:(e,{attrs:n})=>()=>e.active?s.h$1(s.Transition,{name:"fade",mode:"out-in"},(()=>{return[s.h$1("div",(e=i({},n),o={class:["component-loading loading-overlay is-overlay"],title:"Loading..."},t(e,a(o))),[s.h$1("div",{class:["loading-background is-overlay"]},""),s.h$1("div",{class:["loading-icon"]})])];var e,o})):null}),E=s.defineComponent({name:"Dropdown",components:{InlineSvg:s.InlineSvg},props:{items:{type:Array,default:()=>[]},maxDropdownItems:{type:Number,default:7},modelValue:null,readonly:{type:Boolean,default:!1},placeholder:{type:String,default:"Select..."},error:{type:Boolean,default:!1},colorScheme:{type:String,default:"default",required:!1}},emits:{change:e=>!0,"update:modelValue":e=>!0},setup(e,t){const a=s.ref(),n=s.ref(null);const o=s.computed((()=>e.items.find((t=>t.value===e.modelValue)))),l=s.computed((()=>{var t,a;return null!=(a=null==(t=o.value)?void 0:t.name)?a:e.placeholder})),r=s.computed((()=>{var e,t;return null!=(t=null==(e=o.value)?void 0:e.style)?t:""})),i=s.ref(!1),c=s.ref(0);function d(){if(null===n.value)return 0;const e=n.value.getBoundingClientRect().width;return Math.ceil(e)}const u=s.ref(0),v=s.ref("");return s.onMounted((()=>{const e=d();u.value=d()-15,v.value=`width: ${e}px;`})),{displayName:l,showList:i,selectItem:function(e){t.emit("change",e.value),t.emit("update:modelValue",e.value),i.value=!1},setItemRef:function(e){},buttonWidth:u,dropdownContainer:a,listWidthStyle:v,listMaxHeight:c,toggleList:function(){e.readonly||(i.value||(c.value=function(){const t=30*e.maxDropdownItems+1;if(null===a.value)return t;const n=a.value.getBoundingClientRect().bottom,o=window.innerHeight-n-10;return o<60?60:o>t?t:o}()),i.value=!i.value)},dropdownList:n,displayStyle:r,selectedItem:o,Icons:s.Icons}}}),L=["readonly"],P=["onClick"];var O=s._export_sfc(E,[["render",function(e,t,a,n,o,l){const r=s.resolveComponent("inline-svg");return s.openBlock(),s.createElementBlock("div",{class:s.normalizeClass(["dropdown-container",[e.colorScheme]]),tabindex:"0",onFocusout:t[1]||(t[1]=s.withModifiers((t=>e.showList=!1),["prevent"])),ref:"dropdownContainer",readonly:e.readonly},[s.createBaseVNode("div",{class:s.normalizeClass(["dropdown-button",{expanded:e.showList,error:e.error}]),style:s.normalizeStyle(`width: ${e.buttonWidth}px; ${e.displayStyle}`),onClick:t[0]||(t[0]=s.withModifiers(((...t)=>e.toggleList&&e.toggleList(...t)),["prevent"]))},[s.createBaseVNode("div",{class:s.normalizeClass(["dropdown-title",{placeholder:void 0===e.selectedItem}])},s.toDisplayString(e.displayName),3),s.createVNode(r,{src:e.Icons.chevronDown,alt:"Chevron down"},null,8,["src"])],6),s.createBaseVNode("div",{class:s.normalizeClass(["dropdown-list",{collapsed:!e.showList}]),style:s.normalizeStyle(`max-height: ${e.listMaxHeight}px; ${e.listWidthStyle}`),ref:"dropdownList"},[(s.openBlock(!0),s.createElementBlock(s.Fragment,null,s.renderList(e.items,((t,a)=>(s.openBlock(),s.createElementBlock("div",{class:s.normalizeClass(["item",{"bottom-border":a!==e.items.length-1}]),style:s.normalizeStyle(t.style),key:a,ref_for:!0,ref:e.setItemRef,onClick:s.withModifiers((a=>e.selectItem(t)),["prevent"])},s.toDisplayString(t.name),15,P)))),128))],6)],42,L)}]]);const A={key:0,class:"passage-table-paginator"},z={class:"page-size-selector"},T={style:{"margin-right":"15px"}},U={class:"paginator-text"},j={class:"paginator-buttons flex-row"},F=["onClick"],Y=["onClick"],R=["onClick"],$=["onClick"],q=["onClick"],W=s.defineComponent({__name:"Paginator",props:{dataset:{},page:{}},emits:["update:page"],setup(e,{emit:t}){const a=e,{t:n}=s.useLocale(),o=s.ref(5),l=[{name:"5",value:5},{name:"10",value:10},{name:"15",value:15}],r=s.computed((()=>i.value.length>1||void 0!==a.dataset&&a.dataset.length>5)),i=s.computed((()=>{if(void 0===a.dataset||0===a.dataset.length)return[];const e=[];for(let t=0;t<a.dataset.length;t+=o.value){const n=a.dataset.slice(t,t+o.value);e.push(n)}return d.value=e[0],u.value=0,e})),c=s.ref([]),d=s.computed({get:()=>c.value,set(e){c.value=e,t("update:page",e)}}),u=s.ref(0),v=s.computed({get:()=>u.value,set(e){u.value=e,i.value&&(d.value=i.value[e])}}),p=s.computed((()=>{var e,t;const l=v.value,r=o.value,i=null!=(t=null==(e=a.dataset)?void 0:e.length)?t:0,c=l*r+1,s=Math.min(l*r+r,i);return n("showing-page-of-n",[c,s,i])})),m=(e,t,a)=>Array.from({length:(t-e)/a+1},((t,n)=>e+n*a)),f=s.computed((()=>{if(i.value.length<3)return m(0,i.value.length-1,1);if(0===v.value)return m(0,2,1);const e=i.value.length;return v.value===e-1?m(e-3,e-1,1):m(v.value-1,v.value+1,1)}));function g(){v.value=0}function y(){0!==v.value&&(v.value-=1)}function B(){v.value!==i.value.length-1&&(v.value+=1)}function h(){v.value!==i.value.length-1&&(v.value=i.value.length-1)}return(e,t)=>r.value?(s.openBlock(),s.createElementBlock("div",A,[s.createBaseVNode("div",z,[s.createBaseVNode("span",T,s.toDisplayString(s.unref(n)("rows-per-page")),1),s.createVNode(O,{modelValue:o.value,"onUpdate:modelValue":t[0]||(t[0]=e=>o.value=e),items:l},null,8,["modelValue"])]),s.createBaseVNode("div",U,s.toDisplayString(p.value),1),s.createBaseVNode("div",j,[s.createBaseVNode("div",{class:s.normalizeClass(["paginator-button",{disabled:0===v.value}]),part:"paginator-button",onClick:s.withModifiers(g,["prevent"])},[s.createVNode(s.unref(s.InlineSvg),{src:s.unref(s.Icons).doubleChevronLeft,alt:"First page"},null,8,["src"])],10,F),s.createBaseVNode("div",{class:s.normalizeClass(["paginator-button",{disabled:0===v.value}]),part:"paginator-button",onClick:s.withModifiers(y,["prevent"])},[s.createVNode(s.unref(s.InlineSvg),{src:s.unref(s.Icons).chevronLeft,alt:"Previous page"},null,8,["src"])],10,Y),(s.openBlock(!0),s.createElementBlock(s.Fragment,null,s.renderList(f.value,(e=>(s.openBlock(),s.createElementBlock("div",{key:e,class:s.normalizeClass(["paginator-button",{selected:e===v.value}]),part:"paginator-button",onClick:s.withModifiers((t=>{return a=e,void(v.value=a);var a}),["prevent"])},s.toDisplayString(e+1),11,R)))),128)),s.createBaseVNode("div",{class:s.normalizeClass(["paginator-button",{disabled:v.value===i.value.length-1}]),part:"paginator-button",onClick:s.withModifiers(B,["prevent"])},[s.createVNode(s.unref(s.InlineSvg),{src:s.unref(s.Icons).chevronRight,alt:"Next page"},null,8,["src"])],10,$),s.createBaseVNode("div",{class:s.normalizeClass(["paginator-button",{disabled:v.value===i.value.length-1}]),part:"paginator-button",onClick:s.withModifiers(h,["prevent"])},[s.createVNode(s.unref(s.InlineSvg),{src:s.unref(s.Icons).doubleChevronRight,alt:"Last page"},null,8,["src"])],10,q)])])):s.createCommentVNode("",!0)}});var H=(e=>(e.default="DEFAULT",e.danger="DANGER",e))(H||{});const K={class:"action-menu"},G=["onMousedown"],J=s.defineComponent({__name:"ActionMenu",props:{actions:{}},setup(e){const t=s.ref(!1);function a(e){t.value=void 0===e?!t.value:e}return(e,n)=>(s.openBlock(),s.createElementBlock("div",K,[s.createBaseVNode("div",{class:"menu-icon",onClick:n[0]||(n[0]=s.withModifiers((e=>a()),["prevent"])),onFocusout:n[1]||(n[1]=s.withModifiers((e=>a(!1)),["prevent"])),tabindex:"0"},[s.createVNode(s.unref(s.InlineSvg),{src:s.unref(s.Icons).ellipsis,alt:"Action menu"},null,8,["src"])],32),s.createBaseVNode("div",{class:s.normalizeClass(["menu-dropdown",{collapsed:!t.value}])},[(s.openBlock(!0),s.createElementBlock(s.Fragment,null,s.renderList(e.actions,(e=>(s.openBlock(),s.createElementBlock("div",{class:s.normalizeClass(["menu-item",{danger:e.type===s.unref(H).danger}]),key:e.displayName,onMousedown:t=>e.action()},s.toDisplayString(e.displayName),43,G)))),128))],2)]))}}),Q={class:"passage-table-header-row",part:"passage-table-header-row"},X={key:0,class:"passage-table-header-cell passage-expansion-cell",part:"passage-table-header-cell"},Z=s.createBaseVNode("th",{class:"passage-table-header-cell passage-action-menu-cell",part:"passage-table-header-cell"},null,-1),ee={class:"passage-table-row",part:"passage-table-row"},te=["onClick"],ae={colspan:3,class:"passage-table-cell",part:"passage-table-cell"},ne={class:"expanded-content"},oe={class:"expanded-label"},le={key:1,class:"passage-table-empty"},re=["colspan"],ie={class:"title secondary-title"},ce=s.defineComponent({__name:"SimpleDataTable",props:{dataset:{},headers:{},columns:{},mobileBreakpoint:{},actions:{}},setup(e){const t=e,a=s.ref(),{t:n}=s.useLocale(),o=s.ref(),l=new ResizeObserver((()=>{i()})),r=s.ref(!1);function i(){if(void 0===o.value)return;const e=o.value.getBoundingClientRect().width;r.value=e<t.mobileBreakpoint}const c=s.ref([]);function d(e){if(null==e.target)return;const t=e.target.previousSibling;return null!=t?t:void 0}function u(e){const t=d(e);void 0!==t&&(t.className="passage-table-row passage-table-row-hover")}function v(e){const t=d(e);void 0!==t&&(t.className="passage-table-row")}function p(e){var a;return void 0===t.actions?[]:null==(a=t.actions)?void 0:a.map((t=>({displayName:t.displayName,type:t.type,action:()=>{t.action(e)}})))}return s.watch(a,(()=>{void 0!==a.value&&(c.value=a.value.map((()=>!1)))})),s.onMounted((()=>{i(),o.value&&l.observe(o.value)})),s.onUnmounted((()=>{l.disconnect()})),(e,t)=>(s.openBlock(),s.createElementBlock("div",null,[s.createBaseVNode("table",{class:"passage-table",ref_key:"tableContainer",ref:o,part:"passage-table"},[s.createBaseVNode("tbody",null,[s.createBaseVNode("tr",Q,[(s.openBlock(!0),s.createElementBlock(s.Fragment,null,s.renderList(r.value?[e.headers[0]]:e.headers,(e=>(s.openBlock(),s.createElementBlock("th",{key:e,class:"passage-table-header-cell",part:"passage-table-header-cell"},s.toDisplayString(e),1)))),128)),r.value?(s.openBlock(),s.createElementBlock("th",X)):s.createCommentVNode("",!0),Z]),a.value?(s.openBlock(!0),s.createElementBlock(s.Fragment,{key:0},s.renderList(a.value,((t,a)=>(s.openBlock(),s.createElementBlock(s.Fragment,{key:a},[s.createBaseVNode("tr",ee,[(s.openBlock(!0),s.createElementBlock(s.Fragment,null,s.renderList(r.value?[e.columns[0]]:e.columns,(n=>(s.openBlock(),s.createElementBlock("td",{key:n,class:s.normalizeClass(["passage-table-cell",{expanded:r.value&&c.value[a]}]),part:"passage-table-cell"},[s.renderSlot(e.$slots,n,{value:t[n],item:t},(()=>[s.createTextVNode(s.toDisplayString(t[n]),1)]))],2)))),128)),r.value?(s.openBlock(),s.createElementBlock("td",{key:0,class:s.normalizeClass(["passage-table-cell passage-expansion-cell",{expanded:r.value&&c.value[a]}]),part:"passage-table-cell",onClick:s.withModifiers((e=>function(e){c.value[e]=!c.value[e]}(a)),["prevent"])},[s.createVNode(s.unref(s.InlineSvg),{class:s.normalizeClass(["table-chevron",{expanded:c.value[a]}]),src:s.unref(s.Icons).tableChevronDown,alt:"Expand row"},null,8,["src","class"])],10,te)):s.createCommentVNode("",!0),s.createBaseVNode("td",{class:s.normalizeClass(["passage-table-cell passage-action-menu-cell",{expanded:r.value&&c.value[a]}]),part:"passage-table-cell"},[s.createVNode(J,{actions:p(t)},null,8,["actions"])],2)]),r.value&&c.value[a]?(s.openBlock(),s.createElementBlock("tr",{key:0,class:"passage-expansion-row",part:"passage-table-expansion-row",onMouseenter:u,onMouseleave:v},[s.createBaseVNode("td",ae,[s.createBaseVNode("div",ne,[(s.openBlock(!0),s.createElementBlock(s.Fragment,null,s.renderList(e.columns.slice(1),((a,n)=>(s.openBlock(),s.createElementBlock("div",{class:"expanded-item",key:a},[s.createBaseVNode("div",oe,s.toDisplayString(e.headers[n+1]),1),s.createBaseVNode("span",null,[s.renderSlot(e.$slots,a,{value:t[a],item:t},(()=>[s.createTextVNode(s.toDisplayString(t[a]),1)]))])])))),128))])])],32)):s.createCommentVNode("",!0)],64)))),128)):(s.openBlock(),s.createElementBlock("tr",le,[s.createBaseVNode("td",{class:"passage-table-empty-cell",colspan:r.value?3:e.columns.length+1},[s.createBaseVNode("div",ie,s.toDisplayString(s.unref(n)("no-devices-found")),1),s.createBaseVNode("div",null,s.toDisplayString(s.unref(n)("there-are-no-devices-registered")),1)],8,re)]))])],512),s.createVNode(W,{dataset:e.dataset,page:a.value,"onUpdate:page":t[0]||(t[0]=e=>a.value=e)},null,8,["dataset","page"])]))}}),se={class:"flex-row flex-end",style:{"margin-bottom":"30px"}},de={class:"title secondary-title"},ue=s.createBaseVNode("div",{class:"spacer"},null,-1),ve={class:"flex-row",style:{"align-items":"center"}},pe={key:0,class:"current-device"},me=s.defineComponent({__name:"DevicesTable",props:{appId:{},userInfo:{},refreshDevices:{type:Function},webauthnAllowed:{type:Boolean}},setup(e){const t=e,{t:a}=s.useLocale(),n=s.ref(),o=s.ref(0),l=s.ref(!1),r=s.ref(!1),i=s.ref(!1),d=s.computed((()=>{if(void 0===t.userInfo)return[];return t.userInfo.webauthn_devices.map((e=>e)).sort(((e,t)=>new Date(e.last_login_at)>new Date(t.last_login_at)?-1:1))}));function u(){if(void 0!==t.userInfo)if(null!==n.value&&void 0!==n.value){if(t.userInfo.webauthn_devices.length>5){const e=n.value.getBoundingClientRect().height;o.value=Math.ceil(e)}}else o.value=0;else o.value=0}const v=s.ref();function p(e){v.value=e,i.value=!0}function m(e){v.value=e,l.value=!0}const f=s.computed((()=>[{displayName:a("edit-device"),type:H.default,action:p},{displayName:a("revoke-device"),type:H.danger,action:m}]));s.onUpdated((()=>{u()})),s.onMounted((()=>c(this,null,(function*(){u()}))));const g=s.computed((()=>{var e,a;if(void 0===t.userInfo)return;const n=localStorage.getItem("psg_cred_obj");if(!n)return;const o=JSON.parse(n)[null!=(a=null==(e=t.userInfo)?void 0:e.id)?a:""];return t.userInfo.webauthn_devices.find((e=>e.cred_id===o))})),y=s.ref(!1);function B(){return c(this,null,(function*(){v.value=void 0,y.value=!0,yield t.refreshDevices(),y.value=!1}))}return(e,t)=>{var c;return s.openBlock(),s.createElementBlock("div",{class:"table-container",style:s.normalizeStyle(`min-height: ${o.value}px`),ref_key:"tableContainerRef",ref:n},[y.value?(s.openBlock(),s.createBlock(_,{key:0,active:y.value},null,8,["active"])):s.createCommentVNode("",!0),s.createBaseVNode("div",se,[s.createBaseVNode("div",de,s.toDisplayString(s.unref(a)("my-passkeys")),1),ue,e.userInfo&&e.webauthnAllowed?(s.openBlock(),s.createElementBlock("button",{key:0,part:"button button-secondary",class:"button is-secondary is-modal",onClick:t[0]||(t[0]=s.withModifiers((e=>r.value=!0),["prevent"]))},s.toDisplayString(s.unref(a)("add-device")),1)):s.createCommentVNode("",!0)]),s.createVNode(ce,{dataset:d.value,headers:[s.unref(a)("name"),s.unref(a)("added-time"),s.unref(a)("last-login")],columns:["friendly_name","created_at","last_login_at"],"mobile-breakpoint":500,actions:f.value},{friendly_name:s.withCtx((({value:e,item:t})=>{var n;return[s.createBaseVNode("div",ve,[s.createTextVNode(s.toDisplayString(e)+" ",1),(null==(n=g.value)?void 0:n.id)===t.id?(s.openBlock(),s.createElementBlock("div",pe,s.toDisplayString(s.unref(a)("current")),1)):s.createCommentVNode("",!0)])]})),created_at:s.withCtx((({value:e})=>[s.createTextVNode(s.toDisplayString(s.unref(s.dayjs)(e).format("MMM D, YYYY")),1)])),last_login_at:s.withCtx((({value:e})=>[s.createTextVNode(s.toDisplayString(s.unref(s.dayjs)(e).format("MMM D, YYYY")),1)])),_:1},8,["dataset","headers","actions"]),s.createVNode(I,{active:r.value,"onUpdate:active":t[1]||(t[1]=e=>r.value=e),"app-id":e.appId,onDialogClose:B},null,8,["active","app-id"]),v.value?(s.openBlock(),s.createBlock(k,{key:1,active:l.value,"onUpdate:active":t[2]||(t[2]=e=>l.value=e),device:v.value,currentDeviceId:null==(c=g.value)?void 0:c.id,onDialogClose:B,"app-id":e.appId},null,8,["active","device","currentDeviceId","app-id"])):s.createCommentVNode("",!0),s.createVNode(N,{active:i.value,"onUpdate:active":t[3]||(t[3]=e=>i.value=e),"app-id":e.appId,deviceObject:v.value,onDialogClose:B},null,8,["active","app-id","deviceObject"])],4)}}});exports._sfc_main=me,exports._sfc_main$1=_,exports.useCurrentUser=function(e){const t=s.ref(!0),a=s.ref(void 0),n=s.ref(void 0);function o(){void 0!==e&&e.user_metadata_schema.forEach((e=>{if(!n.value||!n.value.user_metadata)return;const t=n.value.user_metadata[e.field_name];e.type===s.ce.DATE&&t&&(n.value.user_metadata[e.field_name]=s.dayjs(t).format("MM/DD/YYYY"))}))}return s.onMounted((()=>{!function(){c(this,null,(function*(){try{t.value=!0;const a=new s.Y(e.id).getCurrentUser();a&&(n.value=yield a.userInfo(),void 0!==n.value&&null===n.value.user_metadata&&(n.value.user_metadata={}),o())}catch(l){a.value=l}finally{t.value=!1}}))}()})),{userInfo:n,loading:t,error:a,refreshDevices:function(){return c(this,null,(function*(){if(n.value)try{const a=new s.Y(e.id).getCurrentUser();n.value.webauthn_devices=yield a.listDevices()}catch(o){a.value=o}finally{t.value=!1}}))},refreshMetadata:function(){return c(this,null,(function*(){var l;if(n.value)try{const a=new s.Y(e.id).getCurrentUser();n.value.user_metadata=null!=(l=yield a.getMetadata())?l:{},o()}catch(r){a.value=r}finally{t.value=!1}}))}}},exports.useProfileElementSetup=function(e){function t(){const{updateDefaultCountryCode:t}=s.useDefaultCountryCode();t(e.defaultCountryCode)}t(),s.onBeforeUpdate((()=>{t()}));const{languageLoading:a}=s.useStoreLocale(e),n=s.ref();return s.useIntlTelInput(n),{languageLoading:a,containerRef:n}};
//# 
